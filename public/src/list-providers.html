<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OAuth2 Providers</title>
    <link rel="stylesheet" href="/css/restinpieces.css" />
  </head>
  <body>
    <div class="providers-header">
      <h1>OAuth2 Providers</h1>
      <div class="providers-nav">
        <a href="/login.html">Login</a>
        <a href="/dashboard.html">Dashboard</a>
      </div>
    </div>

    <div class="info-section">
      <button id="get-providers-btn">Get Providers</button>
      <div id="error" class="error"></div>
    </div>

    <div class="info-section providers-result-section" id="result-section">
      <h2 id="providers-header">Providers List</h2>
      <pre id="result"></pre>
    </div>

    <script type="module">
      import Restinpieces from "./js/restinpieces.js";

      function getProviders() {
        const resultDiv = document.getElementById("result");
        const errorDiv = document.getElementById("error");

        resultDiv.textContent = "Loading...";
        errorDiv.textContent = "";

        const rp = new Restinpieces({
          baseURL: "http://localhost:8080",
        });

        rp.listOauth2Providers()
          .then((data) => {
            resultDiv.textContent = JSON.stringify(data, null, 2);
            document.getElementById("result-section").classList.remove("providers-result-section");
          })
          .catch((error) => {
            let errorText = "Error: " + error.message + "\n";
            errorText += "Status: " + error.status + "\n";
            if (error.response) {
              errorText +=
                "Response:\n" + JSON.stringify(error.response, null, 2);
            }
            if (error.url) {
              errorText += "\nURL: " + error.url;
            }
            errorDiv.textContent = errorText;
            resultDiv.textContent = "";
            console.error(error);
          });
      }

      document
        .getElementById("get-providers-btn")
        .addEventListener("click", getProviders);
    </script>
  </body>
</html>
