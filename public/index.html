<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OAuth2 links page</title>
    <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"></script>
</head>
<body>
    <ul id="list">
        <li>Loading OAuth2 providers...</li>
    </ul>

    <script>
        $(document).ready(async function() {
            try {
                const response = await fetch('/oauth2-providers');
                if (!response.ok) {
                    throw new Error('Failed to fetch providers');
                }
                
                const providers = await response.json();
                const listItems = [];
                
                for (const provider of providers) {
                    const $li = $(`<li><a>Login with ${provider.DisplayName}</a></li>`);
                    
                    $li.find("a")
                        .attr("href", provider.AuthURL)
                        .data("provider", provider)
                        .click(function() {
                            localStorage.setItem("provider", JSON.stringify($(this).data("provider")));
                        });
                    
                    listItems.push($li);
                }

                $("#list").html(listItems.length ? listItems : "<li>No OAuth2 providers.</li>");
            } catch (error) {
                console.error('Error loading OAuth2 providers:', error);
                $("#list").html("<li>Error loading providers</li>");
            }
        });
    </script>
</body>
</html>
